"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9496],{2855:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>i});var s=t(4848),c=t(8453);const o={},a="Deployment Tomcat on k8s & \u900f\u904e https \u8a2a\u554f",r={id:"test/Deployment-Tomcat-on-k8s-&-\u900f\u904e-https-\u8a2a\u554f",title:"Deployment Tomcat on k8s & \u900f\u904e https \u8a2a\u554f",description:"\u5efa\u7acb Tomcat",source:"@site/docs/test/Deployment-Tomcat-on-k8s-&-\u900f\u904e-https-\u8a2a\u554f.md",sourceDirName:"test",slug:"/test/Deployment-Tomcat-on-k8s-&-\u900f\u904e-https-\u8a2a\u554f",permalink:"/docs/test/Deployment-Tomcat-on-k8s-&-\u900f\u904e-https-\u8a2a\u554f",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/test/Deployment-Tomcat-on-k8s-&-\u900f\u904e-https-\u8a2a\u554f.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"TEST",permalink:"/docs/category/test"},next:{title:"HAHA",permalink:"/docs/category/haha"}},l={},i=[{value:"\u5efa\u7acb Tomcat",id:"\u5efa\u7acb-tomcat",level:2},{value:"\u900f\u904e https \u9023\u5230 tomcat",id:"\u900f\u904e-https-\u9023\u5230-tomcat",level:2},{value:"on k3s",id:"on-k3s",level:3}];function m(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"deployment-tomcat-on-k8s--\u900f\u904e-https-\u8a2a\u554f",children:"Deployment Tomcat on k8s & \u900f\u904e https \u8a2a\u554f"}),"\n",(0,s.jsx)(n.h2,{id:"\u5efa\u7acb-tomcat",children:"\u5efa\u7acb Tomcat"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Tomcat yaml example"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: tomcat\n  name: tomcat\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: tomcat\n  template:\n    metadata:\n      labels:\n        app: tomcat\n    spec:\n      containers:\n      - image: tomcat\n        name: tomcat\n        ports:\n        - containerPort: 8080\n        lifecycle:\n            postStart:\n              exec:\n                command:\n                  - /bin/sh\n                  - -c\n                  - |\n                   cp -R  /usr/local/tomcat/webapps.dist/* /usr/local/tomcat/webapps/\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5efa\u7acb service"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ kubectl expose deploy tomcat --target-port=8080 --port=8080\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["\u767b\u5165\u4f4d\u7f6e\n",(0,s.jsx)(n.a,{href:"http://localhost:8080",children:"http://localhost:8080"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://hackmd.io/_uploads/rJdy4eNb6.png",alt:""})}),"\n",(0,s.jsx)(n.h2,{id:"\u900f\u904e-https-\u9023\u5230-tomcat",children:"\u900f\u904e https \u9023\u5230 tomcat"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5efa\u7acb\u81ea\u7c3d\u6191\u8b49"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ git clone https://github.com/cooloo9871/openssl.git;cd openssl\n\n# ip \u70ba cluster node ip\n$ ./mk create tomcat.example.com 192.168.11.101\n\n# \u9700\u8981\u6709 dns server \u505a\u540d\u7a31\u89e3\u6790\n$ host tomcat.example.com\ntomcat.example.com has address 192.168.11.101\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5efa\u7acb secret"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ kubectl create secret tls tls-tomcat --cert=cert.pem --key=cert-key.pem\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ kubectl get secret tls-tomcat\nNAME         TYPE                DATA   AGE\ntls-tomcat   kubernetes.io/tls   2      55s\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5efa\u7acb ingress"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: tls-tomcat-ingress\nspec:\n  ingressClassName: nginx\n  tls:\n  - hosts:\n      - tomcat.example.com\n    secretName: tls-tomcat\n  rules:\n  - host: tomcat.example.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: tomcat \n            port:\n              number: 8080\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ kubectl get ing\nNAME                 CLASS   HOSTS                ADDRESS          PORTS     AGE\ntls-tomcat-ingress   nginx   tomcat.example.com   192.168.11.101   80, 443   74s\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u628a ca.pem import \u5230\u700f\u89bd\u5668\n",(0,s.jsx)(n.img,{src:"https://i.imgur.com/JMoScUp.png",alt:""})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["\u900f\u904e\u706b\u72d0\u700f\u89bd\u5668\u5c31\u53ef\u4ee5\u8d70 https\n",(0,s.jsx)(n.img,{src:"https://hackmd.io/_uploads/r1fKL76O6.png",alt:"image"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"on-k3s",children:"on k3s"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5728 k3s ingress \u662f\u4f7f\u7528 traefik"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ kubectl get ingressclass\nNAME      CONTROLLER                      PARAMETERS   AGE\ntraefik   traefik.io/ingress-controller   <none>       7m25s\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: tls-tomcat-ingress\nspec:\n  ingressClassName: traefik         # \u66f4\u6539\u6b64\u884c\n  tls:\n  - hosts:\n      - tomcat2.example.com\n    secretName: tls-tomcat\n  rules:\n  - host: tomcat2.example.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: tomcat \n            port:\n              number: 8080\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ kubectl get ing\nNAME                 CLASS     HOSTS                 ADDRESS          PORTS     AGE\ntls-tomcat-ingress   traefik   tomcat2.example.com   192.168.11.114   80, 443   7s\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u628a ca.pem \u532f\u5165\u700f\u89bd\u5668\u5f8c\u518d\u6b21\u9a57\u8b49\n",(0,s.jsx)(n.img,{src:"https://hackmd.io/_uploads/r1kcNrR_6.png",alt:"image"})]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(6540);const c={},o=s.createContext(c);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);